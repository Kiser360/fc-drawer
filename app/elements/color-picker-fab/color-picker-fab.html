<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<dom-module id="color-picker-fab">
  <template>
    <style>
      :host {
        position:fixed;
        bottom:1.5rem;
        right:1.5rem;
        z-index:5;
      }
      #savedColors {
        display:flex;
        flex-direction: column;
        align-content: space-around;
        justify-content:space-around;
        align-items:center;
      }
      .dot {
        height:32px;
        width:32px;
        margin-bottom:8px;
        background:tomato;
        border-radius:50%;
      }
    </style>
    <div id="savedColors" class="flex-vertical"></div>
    <paper-fab></paper-fab>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'color-picker-fab',
        properties: {
          color: {
            type: String,
            notify: true
          }
        },
        listeners: {
          'tap':'setColor'
        },
        ready: function() {
          var self = this;
          self.colorDots = [
            {color: "hsv(0,.85,.15"},
            {color: "hsv(.25, .85, .15)"},
            {color: "hsv(.5, .85, .15)"},
            {color: "hsv(.75, .85, .15)"}
          ];
          self.colorDots.forEach(function(item){
            self.addColorCircle(item.color);
          });
        },
        setColor: function(e) {
          this.color = e.target.getAttribute("color");
        },
        addColorCircle: function(color) {
          var self = this;
          var dot = document.createElement("div");
          dot.classList.add("dot");
          dot.classList.add("color-picker-fab");
          dot.classList.add("style-scope");
          dot.style.background = self._hsv(color);
          dot.setAttribute("color", self._hsv(color));
          self.$.savedColors.appendChild(dot);
        },
        _hsv: function(color) {
          var numbers = color.split('(')[1].split(')')[0].split(',');
          var h = numbers[0];
          var s = numbers[1];
          var v = numbers[2];
          // Based on tinycolor.js implementation
          h = (h % 1) * 6;
          if (h < 0) h += 6;

          var i = h | 0,
              f = h - i,
              p = v * (1 - s),
              q = v * (1 - f * s),
              t = v * (1 - (1 - f) * s),
              r = [v, q, p, p, t, v][i],
              g = [t, v, v, q, p, p][i],
              b = [p, p, t, v, v, q][i];

          return "rgb(" + Math.round(r * 255) + "," + Math.round(g * 255) + "," + Math.round(b * 255) + ")"; 
        }
      });
    })();
  </script>

</dom-module>